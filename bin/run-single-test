!/usr/bin/env hhvm
<?hh

$projectRoot = dirname(dirname(dirname(dirname(dirname(__FILE__)))));

require_once $projectRoot . '/vendor/autoload.php';
require_once $projectRoot . '/vendor/zynga/phpunit/vendor/autoload.php';

use Zynga\Framework\Environment\CodePath\V1\CodePath;
use Zynga\PHPUnit\V2\RunSingleTestRunner;

$userName = 'unknown';

if (isset($_ENV['USER'])) {
  $userName = $_ENV['USER'];
} else {
  $userName = get_current_user();
}

// This is a work around that the environment may / may not be fully up at this
// moment, so codepath might be unititalized.
if ( CodePath::getRoot() == '' ) {
  CodePath::setRoot($projectRoot);
}

$runner = new RunSingleTestRunner($projectRoot, $userName, $argv);

exit($runner->run());
