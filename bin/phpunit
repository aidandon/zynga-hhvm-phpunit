#!/usr/bin/env hhvm -d hhvm.jit=false --define xdebug.remote_enable=1 --define xdebug.remote_autostart=1 --define xdebug.enable=On --define xdebug.remove_enable=false --define xhprof.output_dir=/tmp --define memory_limit=-1 --define log_errors=true --define hhvm.debug.server_error_message=true
<?hh

$projectRoot = dirname(dirname(dirname(dirname(dirname(__FILE__)))));

require_once $projectRoot . '/vendor/autoload.php';
require_once $projectRoot . '/vendor/zynga/phpunit/vendor/autoload.php';

use Zynga\Framework\Environment\CodePath\V1\CodePath;
use Zynga\PHPUnit\V2\Runner;

$userName = 'unknown';

if (isset($_ENV['USER'])) {
  $userName = $_ENV['USER'];
} else {
  $userName = get_current_user();
}

// This is a work around that the environment may / may not be fully up at this
// moment, so codepath might be unititalized.
if ( CodePath::getRoot() == '' ) {
  CodePath::setRoot($projectRoot);
}

$runner = new Runner($projectRoot, $userName, $argv);

exit($runner->run());
